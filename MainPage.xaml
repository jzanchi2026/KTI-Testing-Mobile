<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             BackgroundColor="#2B0000"
             Padding="0"
             xmlns:local="clr-namespace:MauiApp2"
             x:Name="Home"
             x:Class="MauiApp2.MainPage">

    <ContentPage.Resources>
        <ResourceDictionary>
            <local:NameFallbackConverter x:Key="NameFallbackConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>


    <Shell.TitleView>
        <Grid Padding="10,0" BackgroundColor="Transparent">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <HorizontalStackLayout Spacing="8" VerticalOptions="Center" Grid.Column="2">
                <!-- App Text -->
                <Label Text="HOME"
                    FontSize="18"
                    FontFamily="OpenSansRegular"
                    FontAttributes="Bold"
                    TextColor="White"
                    VerticalOptions="Center"/>
                
                <Label Text="KTI"
                    FontSize="22"
                    FontFamily="HighSchoolUsa"
                    FontAttributes="Bold"
                    TextColor="White"
                    VerticalOptions="Center"/>


                <ImageButton Source="applogo.png"
                            HeightRequest="24"
                            WidthRequest="24"
                            BackgroundColor="Transparent"
                            Clicked="ProfileButton_Clicked"/>
            </HorizontalStackLayout>
        </Grid>
    </Shell.TitleView>


    <Grid RowSpacing="0">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>     <!-- Search bar -->
            <RowDefinition Height="*"/>        <!-- Tool list -->
        </Grid.RowDefinitions>


        <!-- Background image -->
        <Image Source="loginbg.png"
               Aspect="AspectFill"
               Grid.RowSpan="3"
               Opacity="0.55" />

        <!-- Search bar -->
        <Grid Grid.Row="0" Padding="0" BackgroundColor="Transparent">
            <SearchBar x:Name="searchBar"
                Placeholder="Search..."
                TextChanged="SearchBar_TextChanged"
                SearchButtonPressed="SearchBar_SearchButtonPressed"
                BackgroundColor="White"
                TextColor="Black"
                CancelButtonColor="Black"/>

        </Grid>

        <CollectionView x:Name="toolList"
                Grid.Row="1"
                SelectionMode="Single"
                ItemsLayout="VerticalGrid, 2"
                SelectionChanged="ToolList_SelectionChanged"
                Margin="10,0"
                IsGrouped="True">

            <!-- GROUP HEADER -->
            <CollectionView.GroupHeaderTemplate>
                <DataTemplate>
                    <Label Text="{Binding Title}"
                        FontSize="24"
                        FontFamily="OpenSansSemiBold"
                        TextColor="White"
                        Margin="10,15,0,5"/>
                </DataTemplate>
            </CollectionView.GroupHeaderTemplate>

            <!-- ITEM TEMPLATE -->
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border Stroke="#2B0000"
                            StrokeThickness="2"
                            Background="#803C3C"
                            Margin="5"
                            Padding="12"
                            VerticalOptions="Center"
                            StrokeShape="RoundRectangle 16"
                            HeightRequest="225">

                        <Grid RowDefinitions="Auto, Auto, *">

                            <Grid Grid.Row="0"
                                HeightRequest="160"
                                WidthRequest="150"
                                Margin="5"
                                HorizontalOptions="Center">

                                <Border Background="White"
                                        Padding="10"
                                        StrokeShape="RoundRectangle 16">
                                    <Image Source="hammor.png"
                                        Aspect="AspectFill"
                                        BackgroundColor="White"
                                        HeightRequest="160"
                                        WidthRequest="150" />
                                </Border>
                            </Grid>

                            <Label
                                Grid.Row="1"
                                FontSize="18"
                                FontAttributes="Bold"
                                TextColor="White"
                                FontFamily="OpenSansSemiBold"
                                TextTransform="Uppercase"
                                LineBreakMode="TailTruncation"
                                MaxLines="1"
                                Text="{Binding Converter={StaticResource NameFallbackConverter}}" />
                        </Grid>

                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>


    </Grid>

</ContentPage>
